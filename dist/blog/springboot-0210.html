<!DOCTYPE html><html lang="en" data-theme="light" class="astro-37fxchfa"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><meta name="referrer" content="no-referrer"><meta name="generator" content="Astro v3.6.0"><title>Nacos Blog</title><link rel="stylesheet" href="/_astro/index.31fde076.css" />
<style>.sl-markdown-content :not(h1,h2,h3,h4,h5,h6)+:is(h1,h2,h3,h4,h5,h6):not(:where(.not-content *)){margin-top:2.5rem}.sl-markdown-content li+li:not(:where(.not-content *)),.sl-markdown-content dt+dt:not(:where(.not-content *)),.sl-markdown-content dt+dd:not(:where(.not-content *)),.sl-markdown-content dd+dd:not(:where(.not-content *)){margin-top:.25rem}.sl-markdown-content li>:last-child:not(li,ul,ol):not(a,strong,em,del,span,input,:where(.not-content *)){margin-bottom:1.25rem}.sl-markdown-content dt:not(:where(.not-content *)){font-weight:700}.sl-markdown-content dd:not(:where(.not-content *)){padding-inline-start:1rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6):not(:where(.not-content *)){color:#f4f4f6;line-height:var(--sl-line-height-headings);font-weight:600}.sl-markdown-content :is(img,picture,video,canvas,svg,iframe):not(:where(.not-content *)){display:block;max-width:100%;height:auto}.sl-markdown-content h1:not(:where(.not-content *)){font-size:var(--sl-text-h1)}.sl-markdown-content h2:not(:where(.not-content *)){font-size:var(--sl-text-h2)}.sl-markdown-content h3:not(:where(.not-content *)){font-size:var(--sl-text-h3)}.sl-markdown-content h4:not(:where(.not-content *)){font-size:var(--sl-text-h4)}.sl-markdown-content h5:not(:where(.not-content *)){font-size:var(--sl-text-h5)}.sl-markdown-content h6:not(:where(.not-content *)){font-size:var(--sl-text-h6)}.sl-markdown-content a:not(:where(.not-content *)){color:var(--sl-color-text-accent)}.sl-markdown-content a:hover:not(:where(.not-content *)){color:var(--sl-color-white)}.sl-markdown-content code:not(:where(.not-content *)){background-color:var(--sl-color-bg-inline-code);margin-block:-.125rem;padding:.125rem .375rem;font-size:var(--sl-text-code-sm)}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) code{font-size:inherit}.sl-markdown-content pre:not(:where(.not-content *)){border:1px solid var(--sl-color-gray-5);padding:.75rem 1rem;font-size:var(--sl-text-code);-moz-tab-size:2;-o-tab-size:2;tab-size:2}.sl-markdown-content pre code:not(:where(.not-content *)){all:unset;font-family:var(--__sl-font-mono)}.sl-markdown-content blockquote:not(:where(.not-content *)){border-inline-start:1px solid var(--sl-color-gray-5);padding-inline-start:1rem}.sl-markdown-content table:not(:where(.not-content *)){display:block;overflow:auto;border-collapse:collapse}.sl-markdown-content tr:nth-child(2n):not(:where(.not-content *)){background-color:var(--sl-color-gray-7, var(--sl-color-gray-6))}.sl-markdown-content :is(th,td):not(:where(.not-content *)){border:1px solid var(--sl-color-hairline-light);padding:.375rem .8125rem}.sl-markdown-content hr:not(:where(.not-content *)){border:0;border-bottom:1px solid var(--sl-color-hairline)}.sl-markdown-content h2{line-height:3.5rem}main:where(.astro-bvzihdzo){width:calc(100% - 2em);max-width:100%;margin:0}.hero-image:where(.astro-bvzihdzo){width:100%}.hero-image:where(.astro-bvzihdzo) img:where(.astro-bvzihdzo){display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.nacos-prose:where(.astro-bvzihdzo){width:720px;max-width:calc(100% - 2em);margin:auto;padding:1em;color:rgb(var(--gray-dark))}.title:where(.astro-bvzihdzo){margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title:where(.astro-bvzihdzo) h1:where(.astro-bvzihdzo){margin:0 0 .5em}.date:where(.astro-bvzihdzo){margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on:where(.astro-bvzihdzo){font-style:italic}
@media (max-width: 36rem){html{font-size:12px}}
</style><script type="module" src="/_astro/hoisted.1dcaf7ef.js"></script></head> <body class="astro-37fxchfa"> <header-layout class="header bg-gray-14 relative astro-3ef6ksr2" style="position: sticky;"> <div data-modal-panel class="modal-panel hidden h-screen absolute left-0 right-0 top-0 astro-3ef6ksr2"></div> <div class="nav bg-gray-14 relative top-0 right-0 bottom-0 left-0 flex items-center justify-between astro-3ef6ksr2"> <!-- logo --> <a href="/" class="astro-3ef6ksr2"> <img class="logo astro-3ef6ksr2" src="../../../public/nacos_white.png"> </a> <!-- 菜单 --> <div class="nav_menu flex h-full items-center astro-3ef6ksr2"> <div class="menu-item h-full flex items-center cursor-pointer text-gray-06 text-sm px-4 astro-3ef6ksr2"> <div data-docs class="h-full flex items-center p-0.5 astro-3ef6ksr2"> <span class="title astro-3ef6ksr2">DOCS</span> <svg data-docs-arrow class="arrow ml-2 astro-3ef6ksr2" width="10" height="7" viewBox="0 0 10 7" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M8.05264 2L5.05264 5.00649L2.05264 2" stroke="#a3a6b3" stroke-width="1.25" stroke-linecap="square" class="astro-3ef6ksr2"></path> </svg> </div> <div data-docs-dropdown class="dropdown-panel bg-gray-14 hidden invisible opacity-0 absolute left-0 right-0 astro-3ef6ksr2"> <div class="flex pb-10 pt-14 px-24 astro-3ef6ksr2"> <div class="shortcut-menu flex flex-col px-7 mr-14 astro-3ef6ksr2"> <span class="text-xs text-gray-10 mb-2 astro-3ef6ksr2">Documentation</span> <a href="/docs/what-is-nacos" class="flex items-center mt-3 cursor-pointer astro-3ef6ksr2"> <span class="text-sm text-gray-02 astro-3ef6ksr2">1.x</span> </a><a href="/docs/v2/what-is-nacos" class="flex items-center mt-3 cursor-pointer astro-3ef6ksr2"> <span class="text-sm text-gray-02 astro-3ef6ksr2">2.x</span> </a> </div> </div> </div> </div> <span class="text-gray-06 text-xs astro-3ef6ksr2">|</span> <div class="menu-item h-full flex items-center cursor-pointer text-gray-06 text-sm px-4 astro-3ef6ksr2"> <div data-nacos-cloud class="h-full flex items-center p-0.5 astro-3ef6ksr2"> <span class="title astro-3ef6ksr2">NACOS CLOUD</span> </div> </div> <span class="text-gray-06 text-xs astro-3ef6ksr2">|</span> <div class="menu-item h-full flex items-center cursor-pointer text-gray-06 text-sm px-4 astro-3ef6ksr2"> <div data-community class="h-full flex items-center p-0.5 astro-3ef6ksr2"> <span class="title astro-3ef6ksr2">COMMUNITY</span> <svg data-community-arrow class="arrow ml-2 astro-3ef6ksr2" width="10" height="7" viewBox="0 0 10 7" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M8.05264 2L5.05264 5.00649L2.05264 2" stroke="#a3a6b3" stroke-width="1.25" stroke-linecap="square" class="astro-3ef6ksr2"></path> </svg> </div> <div data-community-dropdown class="dropdown-panel bg-gray-14 hidden invisible opacity-0 absolute left-0 right-0 z-50 astro-3ef6ksr2"> <div class="flex pb-10 pt-14 px-24 justify-center astro-3ef6ksr2"> <div class="flex mr-32 astro-3ef6ksr2"> <div class="shortcut-menu flex flex-col px-7 mr-14 astro-3ef6ksr2"> <span class="text-xs text-gray-10 mb-2 astro-3ef6ksr2">COMMUNITY</span> <a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Contact</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Report</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Contribute</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Stars</a> </div> <div class="shortcut-menu flex flex-col px-7 mr-14 astro-3ef6ksr2"> <span class="text-xs text-gray-10 mb-2 astro-3ef6ksr2">EVENTS</span> <a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Events</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">News</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Meetup</a> <span class="text-xs text-gray-10 mb-2 mt-10 astro-3ef6ksr2">Resources</span> <a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/blog">Blog</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">E-book</a> </div> </div> <div class="flex astro-3ef6ksr2"> <div class="shortcut-card bg-gray-13 rounded-2xl p-2 flex flex-col w-64 ml-4 astro-3ef6ksr2"> <img class=" astro-3ef6ksr2" src="../../../public/left-shortcut.png"> <div class="text-blue-01 text-sm mt-3 line-clamp-3 h-16 astro-3ef6ksr2">Key to service-centric (for example microservice or cloud-native) architectures.</div> <button class="btn mt-8 w-fit text-xs bg-gray-12 text-gray-01 border-0 rounded-3xl astro-3ef6ksr2">READ ARTICLE</button> </div><div class="shortcut-card bg-gray-13 rounded-2xl p-2 flex flex-col w-64 ml-4 astro-3ef6ksr2"> <img class=" astro-3ef6ksr2" src="../../../public/right-shortcut.png"> <div class="text-blue-01 text-sm mt-3 line-clamp-3 h-16 astro-3ef6ksr2">An easy-to-use platform for building cloud native applications</div> <button class="btn mt-8 w-fit text-xs bg-gray-12 text-gray-01 border-0 rounded-3xl astro-3ef6ksr2">READ ARTICLE</button> </div> </div> </div> </div> </div> <span class="text-gray-06 text-xs astro-3ef6ksr2">|</span> <div class="menu-item h-full flex items-center cursor-pointer text-gray-06 text-sm px-4 astro-3ef6ksr2"> <div data-demo class="h-full flex items-center p-0.5 astro-3ef6ksr2"> <span class="title astro-3ef6ksr2">DEMO</span> </div> </div> </div> <!-- 右侧菜单 --> <div class="astro-3ef6ksr2">  </div> <!-- 小屏适配 --> <div class="menu_hamburger hidden cursor-pointer astro-3ef6ksr2"> <button class="text-gray-01 bg-gray-14 flex items-center astro-3ef6ksr2"> <svg class="cursor-pointer astro-3ef6ksr2" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M21 17H3C2.447 17 2 17.448 2 18C2 18.552 2.447 19 3 19H21C21.553 19 22 18.552 22 18C22 17.448 21.553 17 21 17ZM21 5H3C2.447 5 2 5.448 2 6C2 6.552 2.447 7 3 7H21C21.553 7 22 6.552 22 6C22 5.448 21.553 5 21 5ZM22 12C22 12.552 21.553 13 21 13H3C2.447 13 2 12.552 2 12C2 11.448 2.447 11 3 11H21C21.553 11 22 11.448 22 12Z" fill="currentColor" class="astro-3ef6ksr2"></path><mask id="mask0" mask="true" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="5" width="20" height="14" class="astro-3ef6ksr2"><path fill-rule="evenodd" clip-rule="evenodd" d="M21 17H3C2.447 17 2 17.448 2 18C2 18.552 2.447 19 3 19H21C21.553 19 22 18.552 22 18C22 17.448 21.553 17 21 17ZM21 5H3C2.447 5 2 5.448 2 6C2 6.552 2.447 7 3 7H21C21.553 7 22 6.552 22 6C22 5.448 21.553 5 21 5ZM22 12C22 12.552 21.553 13 21 13H3C2.447 13 2 12.552 2 12C2 11.448 2.447 11 3 11H21C21.553 11 22 11.448 22 12Z" fill="currentColor" class="astro-3ef6ksr2"></path></mask><g mask="url(#mask0)" class="astro-3ef6ksr2"><path fill-rule="evenodd" clip-rule="evenodd" d="M0 0H24V24H0V0Z" fill="#a3a6b3" class="astro-3ef6ksr2"></path></g></svg> </button> </div> <!-- 移动端导航菜单 --> <div data-mobile-menu class="overflow-hidden hidden flex flex-col w-screen bg-gray-01 h-screen absolute left-0 right-0 top-0 astro-3ef6ksr2"> <!-- 顶部logo --> <div class="bg-gray-14 h-16 px-8 flex items-center justify-between astro-3ef6ksr2"> <a href="/" class="astro-3ef6ksr2"> <img class="logo astro-3ef6ksr2" src="../../../public/nacos_white.png"> </a> <div class="menu_close flex items-center cursor-pointer astro-3ef6ksr2"> <button class="text-gray-01 bg-gray-14 flex items-center astro-3ef6ksr2"> <svg class="cursor-pointer astro-3ef6ksr2" width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.61328 1.70312L15.6133 15.7031" stroke="#a3a6b3" stroke-width="2" stroke-linecap="round" class="astro-3ef6ksr2"></path><path d="M15.6133 1.70312L1.61328 15.7031" stroke="#a3a6b3" stroke-width="2" stroke-linecap="round" class="astro-3ef6ksr2"></path></svg> </button> </div> </div> <div data-mobile-menu-list class="w-full pl-8 astro-3ef6ksr2"> <ul class="list-none pl-0 astro-3ef6ksr2"> <li class="astro-3ef6ksr2"> <div mobile-menu-expand-docs class="astro-3ef6ksr2"> <button class="pl-0 mt-4 bg-gray-01 flex items-center cursor-pointer astro-3ef6ksr2"> <span class="mr-2 text-gray-14 text-sm astro-3ef6ksr2">DOCS</span> <svg width="12" height="12" viewBox="0 0 9 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="astro-3ef6ksr2"><path d="M1 1L7 7L1 13" stroke="#2e3038" stroke-width="2" class="astro-3ef6ksr2"></path></svg> </button> </div> <div mobile-menu-expand-content-docs class="px-8 hidden invisible opacity-0 w-screen bg-gray-01 absolute left-0 right-0 top-16 astro-3ef6ksr2"> <div mobile-menu-fold-docs class="flex items-center pt-8 pb-4 astro-3ef6ksr2"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" class="rotate-180 mr-4 astro-3ef6ksr2" fill="none" viewBox="0 0 9 14" stroke="#2e3038"> <path stroke-width="2" d="M1 1L7 7L1 13" class="astro-3ef6ksr2"></path> </svg> <span class="text-gray-14 text-sm astro-3ef6ksr2">DOCS</span> </div> <div class="divider divider-vertical bg-gray-01 h-[0.05rem] astro-3ef6ksr2"></div> <div class="astro-3ef6ksr2"> <span class="text-xs text-gray-12 astro-3ef6ksr2">Documentation</span> <ul class="pl-0 list-none astro-3ef6ksr2"> <a href="/docs/what-is-nacos" class="flex items-center mt-3 cursor-pointer astro-3ef6ksr2"> <li class="text-sm text-gray-14 astro-3ef6ksr2">1.x</li> </a><a href="/docs/v2/what-is-nacos" class="flex items-center mt-3 cursor-pointer astro-3ef6ksr2"> <li class="text-sm text-gray-14 astro-3ef6ksr2">2.x</li> </a> </ul> </div> </div> </li> <li class="mt-4 astro-3ef6ksr2"> <a href="/nacosCloud" class="text-gray-14 text-sm astro-3ef6ksr2">NACOS CLOUD</a> </li> <li class="astro-3ef6ksr2"> <div mobile-menu-expand-com class="astro-3ef6ksr2"> <button class="pl-0 mt-4 bg-gray-01 flex items-center cursor-pointer astro-3ef6ksr2"> <span class="mr-2 text-gray-14 text-sm astro-3ef6ksr2">COMMUNITY</span> <svg width="12" height="12" viewBox="0 0 9 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="astro-3ef6ksr2"><path d="M1 1L7 7L1 13" stroke="#2e3038" stroke-width="2" class="astro-3ef6ksr2"></path></svg> </button> </div> <div mobile-menu-expand-content-com class="px-8 hidden invisible opacity-0 w-screen bg-gray-01 absolute left-0 right-0 top-16 astro-3ef6ksr2"> <div mobile-menu-fold-com class="flex items-center pt-8 pb-4 astro-3ef6ksr2"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" class="rotate-180 mr-4 astro-3ef6ksr2" fill="none" viewBox="0 0 9 14" stroke="#2e3038"> <path stroke-width="2" d="M1 1L7 7L1 13" class="astro-3ef6ksr2"></path> </svg> <span class="text-gray-14 text-sm astro-3ef6ksr2">COMMUNITY</span> </div> <div class="divider divider-vertical bg-gray-01 h-[0.05rem] astro-3ef6ksr2"></div> <div class="mobile_menu_community flex justify-between astro-3ef6ksr2"> <div class="mb-6 astro-3ef6ksr2"> <span class="text-xs text-gray-7 astro-3ef6ksr2">COMMUNITY</span> <ul class="pl-0 list-none astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Contact </li><li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Report </li><li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Contribute </li><li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Stars </li> </ul> </div> <div class="mb-6 astro-3ef6ksr2"> <span class="text-xs text-gray-7 astro-3ef6ksr2">EVENTS</span> <ul class="pl-0 list-none astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Events </li><li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> News </li><li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Meetup </li> </ul> </div> <div class="mb-6 astro-3ef6ksr2"> <span class="text-xs text-gray-7 astro-3ef6ksr2">Resources</span> <ul class="pl-0 list-none astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Blog </li><li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> E-book </li> </ul> </div> </div> </div> </li> <li class="mt-4 astro-3ef6ksr2"> <a href="/" class="text-gray-14 text-sm astro-3ef6ksr2">DEMO</a> </li> </ul> </div> </div> </div> </header-layout>    <div class="sl-markdown-content bg-gray-14 text-gray-01 astro-bvzihdzo"> <div class="hero-image  astro-bvzihdzo">  </div> <div class="nacos-prose astro-bvzihdzo"> <div class="title astro-bvzihdzo"> <div class="date astro-bvzihdzo"> <time datetime="2021-07-26T00:00:00.000Z"> Jul 26, 2021 </time>  </div> <h1 class="astro-bvzihdzo">Nacos-spring-boot0.2.10发布，全面支持Nacos2.0</h1> <hr class="astro-bvzihdzo"> </div>  <p><a name="0YIG0"></a></p>
<p>随着Nacos2.0成熟稳定，Nacos-spring-boot发布0.1.10、0.2.10两个核心版本，全面支持了Nacos2.0，同时支持自动识别配置类型注入能力，修复了高并发场景下数据一致性问题。</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.t1efu.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#F97583">&#x3C;</span><span style="--0:#E1E4E8">dependency</span><span style="--0:#F97583">></span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#F97583">&#x3C;</span><span style="--0:#E1E4E8">groupId</span><span style="--0:#F97583">></span><span style="--0:#E1E4E8">com.alibaba.boot</span><span style="--0:#F97583">&#x3C;/</span><span style="--0:#E1E4E8">groupId</span><span style="--0:#F97583">></span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#F97583">&#x3C;</span><span style="--0:#E1E4E8">artifactId</span><span style="--0:#F97583">></span><span style="--0:#E1E4E8">nacos</span><span style="--0:#F97583">-</span><span style="--0:#E1E4E8">config</span><span style="--0:#F97583">-</span><span style="--0:#E1E4E8">spring</span><span style="--0:#F97583">-</span><span style="--0:#E1E4E8">boot</span><span style="--0:#F97583">-</span><span style="--0:#E1E4E8">starter</span><span style="--0:#F97583">&#x3C;/</span><span style="--0:#E1E4E8">artifactId</span><span style="--0:#F97583">></span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#F97583">&#x3C;</span><span style="--0:#E1E4E8">version</span><span style="--0:#F97583">></span><span style="--0:#79B8FF">0.2</span><span style="--0:#E1E4E8">.</span><span style="--0:#FDAEB7;--0fs:italic">10</span><span style="--0:#F97583">&#x3C;/</span><span style="--0:#E1E4E8">version</span><span style="--0:#F97583">></span></div><div class="ec-line"><span style="--0:#F97583">&#x3C;/</span><span style="--0:#E1E4E8">dependency</span><span style="--0:#F97583">></span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<dependency>  <groupId>com.alibaba.boot</groupId>  <artifactId>nacos-config-spring-boot-starter</artifactId>  <version>0.2.10</version></dependency>"><div></div></button></div></figure></div>
<p>Nacos-spring-boot老用户，将相关maven依赖进行如下替换，即可快速升级。</p>
<p>本文将系统介绍新版本增强能力，并且以一次生产环境的配置管理项目构建过程为例，详细描述新版本Nacos Spring Boot0.2.10版本的部署，帮助Spring Boot老用户快速上岸Nacos2.0，感受长连接带来的10倍性能提升。</p>
<h2 id="nacos-spring-boot新版本特性">Nacos-spring-boot新版本特性</h2>
<p>新发布的0.1.10版本和0.2.10版本主要feature增强包括以下几个部分：</p>
<h3 id="全面兼容nacos2体系向长连接时代演进">全面兼容Nacos2体系，向长连接时代演进</h3>
<p>Nacos1体系中，配置中心的订阅、实时推送功能主要通过长轮训进行。尽管长轮训是HTTP短连接体系中被采用较多的动态刷新解决方案，但也不可避免地存在时延过高等缺陷；在生产实践中暴露了一定问题，如下面这两个链接所示</p>
<p><a href="https://github.com/alibaba/nacos/issues/6345" rel="noopener noreferrer" target="_blank">https://github.com/alibaba/nacos/issues/6345</a></p>
<p><a href="https://github.com/alibaba/nacos/issues/2674" rel="noopener noreferrer" target="_blank">https://github.com/alibaba/nacos/issues/2674</a></p>
<p>Nacos2体系将整个配置中心的订阅、推送功能重构成为了基于gRPC的长连接方案，保证了配置刷新实时推送；迄今为止，已经历了大量的生产环境考验。</p>
<h3 id="自动识别配置的文件类型">自动识别配置的文件类型</h3>
<p>在使用Nacos-spring-boot新版本之后，即使用户对配置类型未设置的情况下，nacos-spring-boot也会自动识别该配置的文件类型(json/yaml/properties)并给定默认值。</p>
<p>该机制极大降低了因为文件类型不匹配，业务侧出现配置处理错误的风险。下图为新版本Nacos-spring-boot项目在一次配置文件刷新过程中的工作机制。</p>
<p><img src="/img/blog/springboot1.png" alt="springboot1.png"></p>
<h3 id="nacosvalue注解全面支持spel表达式">@NacosValue注解全面支持Spel表达式</h3>
<p>Spel表达式全称为“Spring Expression Language”，是Spring自带的一种动态字符串构建方式表达式）。用户可以方便地使用Spel表达式来定义NacosValue，与Spring功能完美整合，减少SpringBoot用户们的工作量。
<a name="1Gmg9"></a></p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#e1e4e8">    @NacosValue(value = "${app.name}", autoRefreshed = true)</span></div><div class="ec-line"><span style="--0:#e1e4e8">    private String nacosNameAutoRefreshed;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#e1e4e8">    @NacosValue(value = "${app.name:Nacos}", autoRefreshed = true)</span></div><div class="ec-line"><span style="--0:#e1e4e8">    private String nacosNameAutoRefreshedWithDefaultValue;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#e1e4e8">    @NacosValue("${app.name}")</span></div><div class="ec-line"><span style="--0:#e1e4e8">    private String nacosNameNotAutoRefreshed;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#e1e4e8">    @NacosValue("${app.nacosFieldIntValue:" + VALUE_1 + "}")</span></div><div class="ec-line"><span style="--0:#e1e4e8">    private int nacosFieldIntValue;</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#e1e4e8">    @NacosValue(value = "${app.nacosFieldIntValueAutoRefreshed}", autoRefreshed = true)</span></div><div class="ec-line"><span style="--0:#e1e4e8">    private int nacosFieldIntValueAutoRefreshed;</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="    @NacosValue(value = &#x22;${app.name}&#x22;, autoRefreshed = true)    private String nacosNameAutoRefreshed;    @NacosValue(value = &#x22;${app.name:Nacos}&#x22;, autoRefreshed = true)    private String nacosNameAutoRefreshedWithDefaultValue;    @NacosValue(&#x22;${app.name}&#x22;)    private String nacosNameNotAutoRefreshed;    @NacosValue(&#x22;${app.nacosFieldIntValue:&#x22; + VALUE_1 + &#x22;}&#x22;)    private int nacosFieldIntValue;    @NacosValue(value = &#x22;${app.nacosFieldIntValueAutoRefreshed}&#x22;, autoRefreshed = true)    private int nacosFieldIntValueAutoRefreshed;"><div></div></button></div></figure></div>
<h3 id="修复了高并发场景下的一致性问题">修复了高并发场景下的一致性问题</h3>
<p>一些用户在使用Nacos-spring-boot项目进行大规模压测的过程中，出现了一些配置读取错误：在大流量频繁修改某些dataId的配置的过程中，客户端可能会拉取到旧版本的配置数据，导致客户端配置数据反复。
Nacos-spring-boot新版本通过增加智能锁、升级Nacos-spring依赖等方式，对于潜在的线程安全风险进行了修复。</p>
<h2 id="生产演示">生产演示</h2>
<p>在Nacos服务端，为了方便Nacos部署升级和尽可能保证配置信息的信息安全，我们是从<a href="https://cn.aliyun.com/product/aliware/mse?spm=nacos-website.topbar.0.0.0" rel="noopener noreferrer" target="_blank">阿里云微服务引擎MSE</a> 中购买的一个2核CPU+4G内存的三节点Nacos集群。</p>
<p><img src="/img/blog/springboot2.png" alt="springboot2"></p>
<p>在Nacos客户端，在Springboot老用户可以通过下面方式升级到Nacos-spring-boot新版本。</p>
<h3 id="在-maven-项目的-pomxml-文件中增加或升级以下依赖来获取-starter">在 Maven 项目的 pom.xml 文件中增加（或升级）以下依赖来获取 Starter</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#e1e4e8">&#x3C;dependency></span></div><div class="ec-line"><span style="--0:#e1e4e8">  &#x3C;groupId>com.alibaba.boot&#x3C;/groupId></span></div><div class="ec-line"><span style="--0:#e1e4e8">    &#x3C;artifactId>nacos-config-spring-boot-starter&#x3C;/artifactId></span></div><div class="ec-line"><span style="--0:#e1e4e8">    &#x3C;version>0.2.10&#x3C;/version></span></div><div class="ec-line"><span style="--0:#e1e4e8">&#x3C;/dependency></span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="<dependency>  <groupId>com.alibaba.boot</groupId>    <artifactId>nacos-config-spring-boot-starter</artifactId>    <version>0.2.10</version></dependency>"><div></div></button></div></figure></div>
<p>注： 使用时请根据自定义构建的Spring Boot版本选择相应的nacos-config-spring-boot-starter版本：nacos-config-spring-boot-starter 版本 0.2.10 对应 Spring Boot 2.x 版本，版本 0.1.10 对应 Spring Boot 1.x 版本。</p>
<h3 id="在-applicationproperties-文件中配置连接信息">在 application.properties 文件中配置连接信息</h3>
<p>nacos.config.server-addr=${nacos_server_address}:8848
注：${nacos_server_address}为占位符，表示Nacos server的地址，可直接填入上文中购买的Nacos集群的公网或内网地址。</p>
<h3 id="使用-nacospropertysource-加载-dataid-为-example-的配置源并开启自动更新">使用 @NacosPropertySource 加载 dataId 为 example 的配置源，并开启自动更新</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#e1e4e8">@SpringBootApplication</span></div><div class="ec-line"><span style="--0:#e1e4e8">@NacosPropertySource(dataId = "com.alibaba.nacos.example.properties", autoRefreshed = true)</span></div><div class="ec-line"><span style="--0:#e1e4e8">public class NacosConfigApplication {</span></div><div class="ec-line"><span style="--0:#e1e4e8">     public static void main(String[] args) {</span></div><div class="ec-line"><span style="--0:#e1e4e8">         SpringApplication.run(NacosConfigApplication.class, args);</span></div><div class="ec-line"><span style="--0:#e1e4e8">     }</span></div><div class="ec-line"><span style="--0:#e1e4e8">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="@SpringBootApplication@NacosPropertySource(dataId = &#x22;com.alibaba.nacos.example.properties&#x22;, autoRefreshed = true)public class NacosConfigApplication {     public static void main(String[] args) {         SpringApplication.run(NacosConfigApplication.class, args);     }}"><div></div></button></div></figure></div>
<h3 id="使用-nacosvalue-注解设置属性值">使用 @NacosValue 注解设置属性值。</h3>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#e1e4e8">@Controller</span></div><div class="ec-line"><span style="--0:#e1e4e8">@RequestMapping("config")</span></div><div class="ec-line"><span style="--0:#e1e4e8">public class ConfigController {</span></div><div class="ec-line"><span style="--0:#e1e4e8">    @NacosValue(value = "${connectTimeoutInMills:5000}", autoRefreshed = true)</span></div><div class="ec-line"><span style="--0:#e1e4e8">    private int connectTimeoutInMills;</span></div><div class="ec-line"><span style="--0:#e1e4e8">    @RequestMapping(value = "/get", method = GET)</span></div><div class="ec-line"><span style="--0:#e1e4e8">    @ResponseBody</span></div><div class="ec-line"><span style="--0:#e1e4e8">    public int get() {</span></div><div class="ec-line"><span style="--0:#e1e4e8">        return connectTimeoutInMills;</span></div><div class="ec-line"><span style="--0:#e1e4e8">    }</span></div><div class="ec-line"><span style="--0:#e1e4e8">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="@Controller@RequestMapping(&#x22;config&#x22;)public class ConfigController {    @NacosValue(value = &#x22;${connectTimeoutInMills:5000}&#x22;, autoRefreshed = true)    private int connectTimeoutInMills;    @RequestMapping(value = &#x22;/get&#x22;, method = GET)    @ResponseBody    public int get() {        return connectTimeoutInMills;    }}"><div></div></button></div></figure></div>
<h2 id="结果验证">结果验证</h2>
<p>在本地启动客户端项目，并运行以下命令：</p>
<p><code dir="auto">curl localhost:8080/config/get</code></p>
<p>若返回以下信息，则说明 SDK 可正常使用。</p>
<p><code dir="auto">3000</code></p>
<p>在MSE控制台将示例配置 com.alibaba.nacos.example.properties 更改为以下内容并发布。</p>
<p><code dir="auto">connectTimeoutInMills=6000</code></p>
<p>若Console打印出更新的配置内容 ，则说明SDK的配置自动更新功能正常；工程正式跨入高性能配置中心时代。</p>  </div> </div>   </body> </html> 