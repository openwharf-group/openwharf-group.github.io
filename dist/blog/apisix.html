<!DOCTYPE html><html lang="en" data-theme="light" class="astro-37fxchfa"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><meta name="referrer" content="no-referrer"><meta name="generator" content="Astro v3.6.4"><title>Nacos Blog</title><style>.sl-markdown-content :not(h1,h2,h3,h4,h5,h6)+:is(h1,h2,h3,h4,h5,h6):not(:where(.not-content *)){margin-top:2.5rem;scroll-margin-top:4rem}.sl-markdown-content li+li:not(:where(.not-content *)),.sl-markdown-content dt+dt:not(:where(.not-content *)),.sl-markdown-content dt+dd:not(:where(.not-content *)),.sl-markdown-content dd+dd:not(:where(.not-content *)){margin-top:.25rem}.sl-markdown-content li>:last-child:not(li,ul,ol):not(a,strong,em,del,span,input,:where(.not-content *)){margin-bottom:1.25rem}.sl-markdown-content dt:not(:where(.not-content *)){font-weight:700}.sl-markdown-content dd:not(:where(.not-content *)){padding-inline-start:1rem}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6):not(:where(.not-content *)){color:#f4f4f6;line-height:var(--sl-line-height-headings);font-weight:600}.sl-markdown-content :is(img,picture,video,canvas,svg,iframe):not(:where(.not-content *)){display:block;max-width:100%;height:auto}.sl-markdown-content h1:not(:where(.not-content *)){font-size:var(--sl-text-h1)}.sl-markdown-content h2:not(:where(.not-content *)){font-size:var(--sl-text-h2)}.sl-markdown-content h3:not(:where(.not-content *)){font-size:var(--sl-text-h3)}.sl-markdown-content h4:not(:where(.not-content *)){font-size:var(--sl-text-h4)}.sl-markdown-content h5:not(:where(.not-content *)){font-size:var(--sl-text-h5)}.sl-markdown-content h6:not(:where(.not-content *)){font-size:var(--sl-text-h6)}.sl-markdown-content a:not(:where(.not-content *)){color:var(--sl-color-text-accent)}.sl-markdown-content a:hover:not(:where(.not-content *)){color:var(--sl-color-white)}.sl-markdown-content code:not(:where(.not-content *)){background-color:var(--sl-color-bg-inline-code);margin-block:-.125rem;padding:.125rem .375rem;font-size:var(--sl-text-code-sm)}.sl-markdown-content :is(h1,h2,h3,h4,h5,h6) code{font-size:inherit}.sl-markdown-content pre:not(:where(.not-content *)){border:1px solid var(--sl-color-gray-5);padding:.75rem 1rem;font-size:var(--sl-text-code);-moz-tab-size:2;-o-tab-size:2;tab-size:2}.sl-markdown-content pre code:not(:where(.not-content *)){all:unset;font-family:var(--__sl-font-mono)}.sl-markdown-content blockquote:not(:where(.not-content *)){border-inline-start:1px solid var(--sl-color-gray-5);padding-inline-start:1rem}.sl-markdown-content table:not(:where(.not-content *)){display:block;overflow:auto;border-collapse:collapse}.sl-markdown-content tr:nth-child(2n):not(:where(.not-content *)){background-color:var(--sl-color-gray-7, var(--sl-color-gray-6))}.sl-markdown-content :is(th,td):not(:where(.not-content *)){border:1px solid var(--sl-color-hairline-light);padding:.375rem .8125rem}.sl-markdown-content hr:not(:where(.not-content *)){border:0;border-bottom:1px solid var(--sl-color-hairline)}.sl-markdown-content h2{line-height:3.5rem}main:where(.astro-bvzihdzo){width:calc(100% - 2em);max-width:100%;margin:0}.hero-image:where(.astro-bvzihdzo){width:100%}.hero-image:where(.astro-bvzihdzo) img:where(.astro-bvzihdzo){display:block;margin:0 auto;border-radius:12px;box-shadow:var(--box-shadow)}.nacos-prose:where(.astro-bvzihdzo){width:90%;padding:1em;color:rgb(var(--gray-dark))}.title:where(.astro-bvzihdzo){margin-bottom:1em;padding:1em 0;text-align:center;line-height:1}.title:where(.astro-bvzihdzo) h1:where(.astro-bvzihdzo){margin:0 0 .5em}.date:where(.astro-bvzihdzo){margin-bottom:.5em;color:rgb(var(--gray))}.last-updated-on:where(.astro-bvzihdzo){font-style:italic}
</style>
<link rel="stylesheet" href="/_astro/index.96ed717d.css" />
<style>@media (max-width: 36rem){html{font-size:12px}}
</style><script type="module" src="/_astro/hoisted.a3604078.js"></script></head> <body class="astro-37fxchfa"> <header-layout class="header bg-gray-14 relative astro-3ef6ksr2" style="position: sticky; height: 4rem"> <div data-modal-panel class="modal-panel hidden h-screen absolute left-0 right-0 top-0 astro-3ef6ksr2"></div> <div style="height: 4rem" class="nav bg-gray-14 relative top-0 right-0 bottom-0 left-0 flex items-center justify-between astro-3ef6ksr2"> <!-- logo --> <a href="/" class="astro-3ef6ksr2"> <img class="logo astro-3ef6ksr2" src="/nacos_white.png"> </a> <!-- 菜单 --> <div class="pc_nav_menu flex h-full items-center astro-3ef6ksr2"> <div class="menu-item h-full flex items-center cursor-pointer text-gray-06 text-sm px-4 astro-3ef6ksr2"> <div data-docs class="h-full flex items-center p-0.5 astro-3ef6ksr2"> <span class="title astro-3ef6ksr2">DOCS</span> <svg data-docs-arrow class="arrow ml-2 astro-3ef6ksr2" width="10" height="7" viewBox="0 0 10 7" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M8.05264 2L5.05264 5.00649L2.05264 2" stroke="#a3a6b3" stroke-width="1.25" stroke-linecap="square" class="astro-3ef6ksr2"></path> </svg> </div> <div data-docs-dropdown style="top: 4rem" class="dropdown-panel bg-gray-14 hidden invisible opacity-0 absolute left-0 right-0 astro-3ef6ksr2"> <div class="flex pb-10 pt-14 px-24 astro-3ef6ksr2"> <div class="shortcut-menu flex flex-col px-7 mr-14 astro-3ef6ksr2"> <span class="text-xs text-gray-10 mb-2 astro-3ef6ksr2">Documentation</span> <a href="/docs/what-is-nacos" class="flex items-center mt-3 cursor-pointer astro-3ef6ksr2"> <span class="text-sm text-gray-02 astro-3ef6ksr2">1.x</span> </a><a href="/docs/v2/what-is-nacos" class="flex items-center mt-3 cursor-pointer astro-3ef6ksr2"> <span class="text-sm text-gray-02 astro-3ef6ksr2">2.x</span> </a> </div> </div> </div> </div> <span class="text-gray-06 text-xs astro-3ef6ksr2">|</span> <div class="menu-item h-full flex items-center cursor-pointer text-gray-06 text-sm px-4 astro-3ef6ksr2"> <div data-nacos-cloud class="h-full flex items-center p-0.5 astro-3ef6ksr2"> <span class="title astro-3ef6ksr2">NACOS CLOUD</span> </div> </div> <span class="text-gray-06 text-xs astro-3ef6ksr2">|</span> <div class="menu-item h-full flex items-center cursor-pointer text-gray-06 text-sm px-4 astro-3ef6ksr2"> <div data-community class="h-full flex items-center p-0.5 astro-3ef6ksr2"> <span class="title astro-3ef6ksr2">COMMUNITY</span> <svg data-community-arrow class="arrow ml-2 astro-3ef6ksr2" width="10" height="7" viewBox="0 0 10 7" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M8.05264 2L5.05264 5.00649L2.05264 2" stroke="#a3a6b3" stroke-width="1.25" stroke-linecap="square" class="astro-3ef6ksr2"></path> </svg> </div> <div data-community-dropdown style="top: 4rem" class="dropdown-panel bg-gray-14 hidden invisible opacity-0 absolute left-0 right-0 z-50 astro-3ef6ksr2"> <div class="flex pb-10 pt-14 px-24 justify-center astro-3ef6ksr2"> <div class="flex mr-32 astro-3ef6ksr2"> <div class="shortcut-menu flex flex-col px-7 mr-14 astro-3ef6ksr2"> <span class="text-xs text-gray-10 mb-2 astro-3ef6ksr2">COMMUNITY</span> <a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Contact</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Report</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Contribute</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Stars</a> </div> <div class="shortcut-menu flex flex-col px-7 mr-14 astro-3ef6ksr2"> <span class="text-xs text-gray-10 mb-2 astro-3ef6ksr2">EVENTS</span> <a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Events</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">News</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/">Meetup</a> <span class="text-xs text-gray-10 mb-2 mt-10 astro-3ef6ksr2">Resources</span> <a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/blog">Blog</a><a class="text-sm text-gray-02 mt-3  astro-3ef6ksr2" href="/docs/ebook/iez8a4">E-book</a> </div> </div> <div class="flex astro-3ef6ksr2"> <div class="shortcut-card bg-gray-13 rounded-2xl p-2 flex flex-col w-64 ml-4 astro-3ef6ksr2"> <img class=" astro-3ef6ksr2" src="/left-shortcut.png"> <div class="text-blue-01 text-sm mt-3 line-clamp-3 h-16 astro-3ef6ksr2">Key to service-centric (for example microservice or cloud-native) architectures.</div> <button class="btn mt-8 w-fit text-xs bg-gray-12 text-gray-01 border-0 rounded-3xl astro-3ef6ksr2">READ ARTICLE</button> </div><div class="shortcut-card bg-gray-13 rounded-2xl p-2 flex flex-col w-64 ml-4 astro-3ef6ksr2"> <img class=" astro-3ef6ksr2" src="/right-shortcut.png"> <div class="text-blue-01 text-sm mt-3 line-clamp-3 h-16 astro-3ef6ksr2">An easy-to-use platform for building cloud native applications</div> <button class="btn mt-8 w-fit text-xs bg-gray-12 text-gray-01 border-0 rounded-3xl astro-3ef6ksr2">READ ARTICLE</button> </div> </div> </div> </div> </div> <span class="text-gray-06 text-xs astro-3ef6ksr2">|</span> <div class="menu-item h-full flex items-center cursor-pointer text-gray-06 text-sm px-4 astro-3ef6ksr2"> <div data-demo class="h-full flex items-center p-0.5 astro-3ef6ksr2"> <span class="title astro-3ef6ksr2">DEMO</span> </div> </div> </div> <!-- 右侧菜单 --> <div class="astro-3ef6ksr2">  </div> <!-- 小屏适配 --> <div class="mobile_nav_menu hidden cursor-pointer astro-3ef6ksr2"> <button class="text-gray-01 bg-gray-14 flex items-center astro-3ef6ksr2"> <svg class="cursor-pointer icon ml-8 astro-3ef6ksr2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6304" width="24" height="24"><path d="M192.037 287.953h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 479.169H438.553c-17.673 0-32 14.327-32 32s14.327 32 32 32h393.608c17.673 0 32-14.327 32-32s-14.327-32-32-32zM832.161 735.802H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32zM319.028 351.594l-160 160 160 160z" fill="#f4f4f6" p-id="6305" class="astro-3ef6ksr2"></path></svg> </button> </div> <!-- 移动端导航菜单 --> <div data-mobile-menu class="overflow-hidden hidden flex flex-col w-screen bg-gray-01 h-screen absolute left-0 right-0 top-0 astro-3ef6ksr2"> <!-- 顶部logo --> <div style="height: 4rem" class="bg-gray-14 px-8 flex items-center justify-start astro-3ef6ksr2"> <a href="/" class="astro-3ef6ksr2"> <img class="logo astro-3ef6ksr2" src="/nacos_white.png"> </a> <div class="menu_close flex items-center cursor-pointer astro-3ef6ksr2"> <button class="text-gray-01 bg-gray-14 flex items-center astro-3ef6ksr2"> <svg class="cursor-pointer icon ml-8 astro-3ef6ksr2" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7494" id="mx_n_1702523741163" width="24" height="24"><path d="M192.037 287.953h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32zM192.028 543.17h393.608c17.673 0 32-14.327 32-32s-14.327-32-32-32H192.028c-17.673 0-32 14.327-32 32s14.327 32 32 32zM832.161 735.802H192.037c-17.673 0-32 14.327-32 32s14.327 32 32 32h640.124c17.673 0 32-14.327 32-32s-14.327-32-32-32zM705.162 671.594l160-160-160-160z" fill="#f4f4f6" p-id="7495" class="astro-3ef6ksr2"></path></svg> </button> </div> </div> <div data-mobile-menu-list class="w-full pl-8 astro-3ef6ksr2"> <ul class="list-none pl-0 astro-3ef6ksr2"> <li class="astro-3ef6ksr2"> <div mobile-menu-expand-docs class="astro-3ef6ksr2"> <button class="pl-0 mt-4 bg-gray-01 flex items-center cursor-pointer astro-3ef6ksr2"> <span class="mr-2 text-gray-14 text-sm astro-3ef6ksr2">DOCS</span> <svg width="12" height="12" viewBox="0 0 9 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="astro-3ef6ksr2"><path d="M1 1L7 7L1 13" stroke="#2e3038" stroke-width="2" class="astro-3ef6ksr2"></path></svg> </button> </div> <div mobile-menu-expand-content-docs class="px-8 hidden invisible opacity-0 w-screen bg-gray-01 absolute left-0 right-0 top-16 astro-3ef6ksr2"> <div mobile-menu-fold-docs class="flex items-center pt-8 pb-4 astro-3ef6ksr2"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" class="rotate-180 mr-4 astro-3ef6ksr2" fill="none" viewBox="0 0 9 14" stroke="#2e3038"> <path stroke-width="2" d="M1 1L7 7L1 13" class="astro-3ef6ksr2"></path> </svg> <span class="text-gray-14 text-sm astro-3ef6ksr2">DOCS</span> </div> <div class="divider divider-vertical bg-gray-01 h-[0.05rem] astro-3ef6ksr2"></div> <div class="astro-3ef6ksr2"> <span class="text-xs text-gray-12 astro-3ef6ksr2">Documentation</span> <ul class="pl-0 list-none astro-3ef6ksr2"> <a href="/docs/what-is-nacos" class="flex items-center mt-3 cursor-pointer astro-3ef6ksr2"> <li class="text-sm text-gray-14 astro-3ef6ksr2">1.x</li> </a><a href="/docs/v2/what-is-nacos" class="flex items-center mt-3 cursor-pointer astro-3ef6ksr2"> <li class="text-sm text-gray-14 astro-3ef6ksr2">2.x</li> </a> </ul> </div> </div> </li> <li class="mt-4 astro-3ef6ksr2"> <a href="/nacosCloud" class="text-gray-14 text-sm astro-3ef6ksr2">NACOS CLOUD</a> </li> <li class="astro-3ef6ksr2"> <div mobile-menu-expand-com class="astro-3ef6ksr2"> <button class="pl-0 mt-4 bg-gray-01 flex items-center cursor-pointer astro-3ef6ksr2"> <span class="mr-2 text-gray-14 text-sm astro-3ef6ksr2">COMMUNITY</span> <svg width="12" height="12" viewBox="0 0 9 14" fill="none" xmlns="http://www.w3.org/2000/svg" class="astro-3ef6ksr2"><path d="M1 1L7 7L1 13" stroke="#2e3038" stroke-width="2" class="astro-3ef6ksr2"></path></svg> </button> </div> <div mobile-menu-expand-content-com class="px-8 hidden invisible opacity-0 w-screen bg-gray-01 absolute left-0 right-0 top-16 astro-3ef6ksr2"> <div mobile-menu-fold-com class="flex items-center pt-8 pb-4 astro-3ef6ksr2"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" class="rotate-180 mr-4 astro-3ef6ksr2" fill="none" viewBox="0 0 9 14" stroke="#2e3038"> <path stroke-width="2" d="M1 1L7 7L1 13" class="astro-3ef6ksr2"></path> </svg> <span class="text-gray-14 text-sm astro-3ef6ksr2">COMMUNITY</span> </div> <div class="divider divider-vertical bg-gray-01 h-[0.05rem] astro-3ef6ksr2"></div> <div class="mobile_menu_community flex justify-between astro-3ef6ksr2"> <div class="mb-6 astro-3ef6ksr2"> <span class="text-xs text-gray-7 astro-3ef6ksr2">COMMUNITY</span> <ul class="pl-0 list-none astro-3ef6ksr2"> <a href="/" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Contact </li> </a><a href="/" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Report </li> </a><a href="/" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Contribute </li> </a><a href="/" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Stars </li> </a> </ul> </div> <div class="mb-6 astro-3ef6ksr2"> <span class="text-xs text-gray-7 astro-3ef6ksr2">EVENTS</span> <ul class="pl-0 list-none astro-3ef6ksr2"> <a href="/" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Events </li> </a><a href="/" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> News </li> </a><a href="/" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Meetup </li> </a> </ul> </div> <div class="mb-6 astro-3ef6ksr2"> <span class="text-xs text-gray-7 astro-3ef6ksr2">Resources</span> <ul class="pl-0 list-none astro-3ef6ksr2"> <a href="/blog" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> Blog </li> </a><a href="/docs/ebook/iez8a4" class="astro-3ef6ksr2"> <li class="text-sm text-gray-14 mt-2 cursor-pointer astro-3ef6ksr2"> E-book </li> </a> </ul> </div> </div> </div> </li> <li class="mt-4 astro-3ef6ksr2"> <a href="/" class="text-gray-14 text-sm astro-3ef6ksr2">DEMO</a> </li> </ul> </div> </div> </div> </header-layout>    <div class="bg-gray-14 "> <div class="w-[70%] inline-block"> <div class="sl-markdown-content bg-gray-14 text-gray-01 astro-bvzihdzo"> <div class="hero-image  astro-bvzihdzo">  </div> <div class="nacos-prose mx-auto astro-bvzihdzo"> <div class="title astro-bvzihdzo"> <div class="date astro-bvzihdzo"> <time datetime="2022-02-22T00:00:00.000Z"> Feb 22, 2022 </time>  </div> <h1 class="astro-bvzihdzo">Apache APISIX 基于 Nacos 实现服务发现</h1> <hr class="astro-bvzihdzo"> </div>  <h1 id="背景信息">背景信息</h1>
<h2 id="关于-apache-apisix">关于 Apache APISIX</h2>
<p>Apache APISIX 是一个动态、实时、高性能的 API 网关，提供负载均衡、动态上游、灰度发布、服务熔断、身份认证、可观测性等丰富的流量管理功能。Apache APISIX 不仅拥有众多实用的插件，而且支持插件动态变更和热插拔。</p>
<h2 id="关于-nacos">关于 Nacos</h2>
<p><strong>Nacos</strong> 是阿里巴巴开源的一个易于使用的动态服务发现、配置和服务管理平台。它提供了一组简单易用的特性集，可以帮助您快速实现动态服务发现，服务配置，服务元数据及流量管理，让您更敏捷和容易地构建，交付和管理微服务平台。Nacos 是构建以“服务”为中心的现代应用架构（例如微服务范式、云原生范式）的服务基础设施。</p>
<h1 id="注册中心">注册中心</h1>
<h2 id="什么是注册中心">什么是注册中心</h2>
<p>服务注册中心是服务要实现服务化管理的核心组件，类似于目录服务的作用，也是微服务架构中最基础的设施之一，主要用来存储服务信息，譬如服务提供者 URL 、路由信息等。注册中心的实现是通过一种映射的方式，将复杂的服务端信息映射为简单易懂的信息提供给客户端。</p>
<p>注册中心的核心功能为以下三点：</p>
<ol>
<li>服务注册：<strong>服务提供方</strong>向<strong>注册中心</strong>进行注册。</li>
<li>服务发现：<strong>服务消费方</strong>可以通过注册中心寻找到服务提供方的调用路由信息。</li>
<li>健康检测：确保注册到注册中心的服务节点是可以被正常调用的，避免无效节点导致的调用资源浪费等问题。</li>
</ol>
<h2 id="为什么需要注册中心">为什么需要注册中心？</h2>
<p>注册中心本质上是为了<strong>解耦服务提供者和服务消费者</strong>，在微服务体系中，各个业务服务之间会频繁互相调用，并且需要对各个服务的 IP、port 等路由信息进行统一的管理。但是要如何进行管理呢？我们可以通过注册中心的 <strong>服务注册</strong> 功能将已有服务的相关信息提供到统一的注册中心进行管理。</p>
<p>通过上述描述，您可以了解到注册中心可以帮助用户通过映射快速找到服务和服务地址。随着业务更新迭代，服务会频繁发生变化，在服务端中注册了新的服务或者服务宕机后，客户端仍然可以通过注册中心的 <strong>服务发现</strong> 功能拉取服务列表，如果注册中心的服务节点发生变更，注册中心会发送请求通知客户端重新拉取。</p>
<p>如果服务端的服务突然宕机，并且没有向注册中心反馈，客户端可以通过注册中心的<strong>健康检查</strong>功能，进行固定时间间隔的主动上报心跳方式向服务端表明自己的服务状态。如果服务状态异常，则会通知注册中心，注册中心可以及时把已经宕机的服务节点进行剔除，避免资源的浪费。</p>
<h2 id="apache-apisix--nacos-为用户提供了什么应用场景">Apache APISIX + Nacos 为用户提供了什么应用场景？</h2>
<p>Apache APISIX + Nacos 可以将各个微服务节点中与业务无关的各项控制，集中在 Apache APISIX 中进行统一管理，即通过Apache APISIX 实现接口服务的代理和路由转发的能力。各个微服务在 Nacos 上注册后，Apache APISIX 可以通过 Nacos 的服务发现功能获取服务列表，查找对应的服务地址从而实现动态代理。</p>
<p><img src="/img/blog/apisix.png" alt="img"></p>
<h2 id="前提条件">前提条件</h2>
<p>本文操作基于以下环境进行。</p>
<ul>
<li>操作系统 Centos 7.9。</li>
<li>已安装 Apache APISIX 12.1.0，详情请参考：<a href="https://apisix.apache.org/zh/docs/apisix/how-to-buildhttps://apisix.apache.org/zh/docs/apisix/how-to-build" rel="noopener noreferrer" target="_blank">Apache APISIX how-to-bulid</a>。</li>
<li>已安装 Nacos 2.0.4 及以上版本，详情请参考：<a href="https://nacos.io/zh-cn/docs/quick-start.html" rel="noopener noreferrer" target="_blank">quick start</a>。</li>
<li>已安装 Node.js，详情请参考：<a href="https://github.com/nodejs/help/wiki/Installation" rel="noopener noreferrer" target="_blank">node.js Installation</a>。</li>
</ul>
<h2 id="步骤一服务注册">步骤一：服务注册</h2>
<ol>
<li>使用 Node.js 的 Koa 框架在 3005 端口启动一个简单的测试服务作为<a href="https://apisix.apache.org/zh/docs/apisix/admin-api#upstream" rel="noopener noreferrer" target="_blank">上游（Upstream）</a>。</li>
</ol>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.t1efu.css"><script type="module" src="/_astro/ec.sgewm.js"></script><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#F97583">const</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">Koa</span><span style="--0:#E1E4E8"> </span><span style="--0:#F97583">=</span><span style="--0:#E1E4E8"> </span><span style="--0:#B392F0">require</span><span style="--0:#E1E4E8">(</span><span style="--0:#9ECBFF">'koa'</span><span style="--0:#E1E4E8">);</span></div><div class="ec-line"><span style="--0:#F97583">const</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">app</span><span style="--0:#E1E4E8"> </span><span style="--0:#F97583">=</span><span style="--0:#E1E4E8"> </span><span style="--0:#F97583">new</span><span style="--0:#E1E4E8"> </span><span style="--0:#B392F0">Koa</span><span style="--0:#E1E4E8">();</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#E1E4E8">app.</span><span style="--0:#B392F0">use</span><span style="--0:#E1E4E8">(</span><span style="--0:#F97583">async</span><span style="--0:#E1E4E8"> </span><span style="--0:#FFAB70">ctx</span><span style="--0:#E1E4E8"> </span><span style="--0:#F97583">=></span><span style="--0:#E1E4E8"> {</span></div><div class="ec-line"><span style="--0:#E1E4E8">  ctx.body </span><span style="--0:#F97583">=</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">'Hello World'</span><span style="--0:#E1E4E8">;</span></div><div class="ec-line"><span style="--0:#E1E4E8">});</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#E1E4E8">app.</span><span style="--0:#B392F0">listen</span><span style="--0:#E1E4E8">(</span><span style="--0:#79B8FF">3005</span><span style="--0:#E1E4E8">);</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="const Koa = require(&#x27;koa&#x27;);const app = new Koa();app.use(async ctx => {  ctx.body = &#x27;Hello World&#x27;;});app.listen(3005);"><div></div></button></div></figure></div>
<ol start="2">
<li>在命令行中通过请求 Nacos Open API 的方式进行服务注册。</li>
</ol>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#B392F0">curl</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-X</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">POST</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">'http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=APISIX-NACOS&#x26;ip=127.0.0.1&#x26;port=3005&#x26;ephemeral=false'</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl -X POST &#x27;http://127.0.0.1:8848/nacos/v1/ns/instance?serviceName=APISIX-NACOS&#x26;ip=127.0.0.1&#x26;port=3005&#x26;ephemeral=false&#x27;"><div></div></button></div></figure></div>
<ol start="3">
<li>执行服务注册后使用以下命令查询当前服务情况。</li>
</ol>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#B392F0">curl</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-X</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">GET</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">'http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=APISIX-NACOS'</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl -X GET &#x27;http://127.0.0.1:8848/nacos/v1/ns/instance/list?serviceName=APISIX-NACOS&#x27;"><div></div></button></div></figure></div>
<p>正确返回结果示例如下：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#E1E4E8">{</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"name"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"DEFAULT_GROUP@@APISIX-NACOS"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"groupName"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"DEFAULT_GROUP"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"clusters"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">""</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"cacheMillis"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">10000</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"hosts"</span><span style="--0:#E1E4E8">: [</span></div><div class="ec-line"><span style="--0:#E1E4E8">    {</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"instanceId"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"127.0.0.1#3005#DEFAULT#DEFAULT_GROUP@@APISIX-NACOS"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"ip"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"127.0.0.1"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"port"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">3005</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"weight"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">1.0</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"healthy"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"enabled"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"ephemeral"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"clusterName"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"DEFAULT"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"serviceName"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"DEFAULT_GROUP@@APISIX-NACOS"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"metadata"</span><span style="--0:#E1E4E8">: {},</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"instanceHeartBeatInterval"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">5000</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"instanceHeartBeatTimeOut"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">15000</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"ipDeleteTimeout"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">30000</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"instanceIdGenerator"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"simple"</span></div><div class="ec-line"><span style="--0:#E1E4E8">    }</span></div><div class="ec-line"><span style="--0:#E1E4E8">  ],</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"lastRefTime"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">1643191399694</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"checksum"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">""</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"allIPs"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">false</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"reachProtectionThreshold"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">false</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"valid"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">true</span></div><div class="ec-line"><span style="--0:#E1E4E8">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;name&#x22;: &#x22;DEFAULT_GROUP@@APISIX-NACOS&#x22;,  &#x22;groupName&#x22;: &#x22;DEFAULT_GROUP&#x22;,  &#x22;clusters&#x22;: &#x22;&#x22;,  &#x22;cacheMillis&#x22;: 10000,  &#x22;hosts&#x22;: [    {      &#x22;instanceId&#x22;: &#x22;127.0.0.1#3005#DEFAULT#DEFAULT_GROUP@@APISIX-NACOS&#x22;,      &#x22;ip&#x22;: &#x22;127.0.0.1&#x22;,      &#x22;port&#x22;: 3005,      &#x22;weight&#x22;: 1.0,      &#x22;healthy&#x22;: true,      &#x22;enabled&#x22;: true,      &#x22;ephemeral&#x22;: true,      &#x22;clusterName&#x22;: &#x22;DEFAULT&#x22;,      &#x22;serviceName&#x22;: &#x22;DEFAULT_GROUP@@APISIX-NACOS&#x22;,      &#x22;metadata&#x22;: {},      &#x22;instanceHeartBeatInterval&#x22;: 5000,      &#x22;instanceHeartBeatTimeOut&#x22;: 15000,      &#x22;ipDeleteTimeout&#x22;: 30000,      &#x22;instanceIdGenerator&#x22;: &#x22;simple&#x22;    }  ],  &#x22;lastRefTime&#x22;: 1643191399694,  &#x22;checksum&#x22;: &#x22;&#x22;,  &#x22;allIPs&#x22;: false,  &#x22;reachProtectionThreshold&#x22;: false,  &#x22;valid&#x22;: true}"><div></div></button></div></figure></div>
<h2 id="步骤二新增-nacos-路由">步骤二：新增 Nacos 路由</h2>
<p>使用 Apache APISIX 提供的 Admin API 创建一个新的<a href="https://apisix.apache.org/zh/docs/apisix/admin-api#route" rel="noopener noreferrer" target="_blank">路由（Route）</a>，APISIX 通过 <code dir="auto">upstream.discovery_type</code> 字段选择使用的服务发现类型，<code dir="auto">upstream.service_name</code> 需要与注册中心的对应服务名进行关联，因此创建路由时指定服务发现类型为 <code dir="auto">nacos</code> 。</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#B392F0">curl</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">http://127.0.0.1:9080/apisix/admin/routes/1</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-H</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">'X-API-KEY: edd1c9f034335f136f87ad84b625c8f1'</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-X</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">PUT</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-i</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-d</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">'</span></div><div class="ec-line"><span style="--0:#9ECBFF">{</span></div><div class="ec-line"><span style="--0:#9ECBFF">    "uri": "/nacos/*",</span></div><div class="ec-line"><span style="--0:#9ECBFF">    "upstream": {</span></div><div class="ec-line"><span style="--0:#9ECBFF">        "service_name": "APISIX-NACOS",</span></div><div class="ec-line"><span style="--0:#9ECBFF">        "type": "roundrobin",</span></div><div class="ec-line"><span style="--0:#9ECBFF">        "discovery_type": "nacos"</span></div><div class="ec-line"><span style="--0:#9ECBFF">    }</span></div><div class="ec-line"><span style="--0:#9ECBFF">}'</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl http://127.0.0.1:9080/apisix/admin/routes/1 -H &#x27;X-API-KEY: edd1c9f034335f136f87ad84b625c8f1&#x27; -X PUT -i -d &#x27;{    &#x22;uri&#x22;: &#x22;/nacos/*&#x22;,    &#x22;upstream&#x22;: {        &#x22;service_name&#x22;: &#x22;APISIX-NACOS&#x22;,        &#x22;type&#x22;: &#x22;roundrobin&#x22;,        &#x22;discovery_type&#x22;: &#x22;nacos&#x22;    }}&#x27;"><div></div></button></div></figure></div>
<p>在上述命令中，请求头 <code dir="auto">X-API-KEY</code> 是 Admin API 的访问 token，可以在 <code dir="auto">conf/config.yaml</code> 文件中的 <code dir="auto">apisix.admin_key.key</code> 查看。</p>
<p>添加成功后，正确返回结果示例如下：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#E1E4E8">{</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"action"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"set"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">  </span><span style="--0:#79B8FF">"node"</span><span style="--0:#E1E4E8">: {</span></div><div class="ec-line"><span style="--0:#E1E4E8">    </span><span style="--0:#79B8FF">"key"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"</span><span style="--0:#79B8FF">\/</span><span style="--0:#9ECBFF">apisix</span><span style="--0:#79B8FF">\/</span><span style="--0:#9ECBFF">routes</span><span style="--0:#79B8FF">\/</span><span style="--0:#9ECBFF">1"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">    </span><span style="--0:#79B8FF">"value"</span><span style="--0:#E1E4E8">: {</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"update_time"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">1643191044</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"create_time"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">1643176603</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"priority"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">0</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"uri"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"</span><span style="--0:#79B8FF">\/</span><span style="--0:#9ECBFF">nacos</span><span style="--0:#79B8FF">\/</span><span style="--0:#9ECBFF">*"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"upstream"</span><span style="--0:#E1E4E8">: {</span></div><div class="ec-line"><span style="--0:#E1E4E8">        </span><span style="--0:#79B8FF">"hash_on"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"vars"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">        </span><span style="--0:#79B8FF">"discovery_type"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"nacos"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">        </span><span style="--0:#79B8FF">"scheme"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"http"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">        </span><span style="--0:#79B8FF">"pass_host"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"pass"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">        </span><span style="--0:#79B8FF">"type"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"roundrobin"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">        </span><span style="--0:#79B8FF">"service_name"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"APISIX-NACOS"</span></div><div class="ec-line"><span style="--0:#E1E4E8">      },</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"id"</span><span style="--0:#E1E4E8">: </span><span style="--0:#9ECBFF">"1"</span><span style="--0:#E1E4E8">,</span></div><div class="ec-line"><span style="--0:#E1E4E8">      </span><span style="--0:#79B8FF">"status"</span><span style="--0:#E1E4E8">: </span><span style="--0:#79B8FF">1</span></div><div class="ec-line"><span style="--0:#E1E4E8">    }</span></div><div class="ec-line"><span style="--0:#E1E4E8">  }</span></div><div class="ec-line"><span style="--0:#E1E4E8">}</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="{  &#x22;action&#x22;: &#x22;set&#x22;,  &#x22;node&#x22;: {    &#x22;key&#x22;: &#x22;\/apisix\/routes\/1&#x22;,    &#x22;value&#x22;: {      &#x22;update_time&#x22;: 1643191044,      &#x22;create_time&#x22;: 1643176603,      &#x22;priority&#x22;: 0,      &#x22;uri&#x22;: &#x22;\/nacos\/*&#x22;,      &#x22;upstream&#x22;: {        &#x22;hash_on&#x22;: &#x22;vars&#x22;,        &#x22;discovery_type&#x22;: &#x22;nacos&#x22;,        &#x22;scheme&#x22;: &#x22;http&#x22;,        &#x22;pass_host&#x22;: &#x22;pass&#x22;,        &#x22;type&#x22;: &#x22;roundrobin&#x22;,        &#x22;service_name&#x22;: &#x22;APISIX-NACOS&#x22;      },      &#x22;id&#x22;: &#x22;1&#x22;,      &#x22;status&#x22;: 1    }  }}"><div></div></button></div></figure></div>
<p>除此之外，您还可以在 <code dir="auto">upstream.discovery_args</code> 中传递其他服务相关参数用于指定服务所在的命名空间或组别，具体内容可参考下表：</p>





























<table><thead><tr><th><strong>名字</strong></th><th><strong>类型</strong></th><th><strong>可选项</strong></th><th><strong>默认值</strong></th><th><strong>有效值</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>namespace_id</td><td>string</td><td>可选</td><td>public</td><td></td><td>服务所在的命名空间</td></tr><tr><td>group_name</td><td>string</td><td>可选</td><td>DEFAULT_GROUP</td><td></td><td>服务所在的组</td></tr></tbody></table>
<h2 id="步骤三验证配置结果">步骤三：验证配置结果</h2>
<p>使用以下命令发送请求至需要配置的路由。</p>
<div class="expressive-code"><figure class="frame is-terminal not-content"><figcaption class="header"><span class="title"></span><span class="sr-only">Terminal window</span></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#B392F0">curl</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">-i</span><span style="--0:#E1E4E8"> </span><span style="--0:#9ECBFF">http://127.0.0.1:9080/nacos/</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="curl -i http://127.0.0.1:9080/nacos/"><div></div></button></div></figure></div>
<p>正常返回结果示例如下：</p>
<div class="expressive-code"><figure class="frame not-content"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><span style="--0:#E1E4E8">HTTP/</span><span style="--0:#79B8FF">1</span><span style="--0:#E1E4E8">.</span><span style="--0:#79B8FF">1</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">200</span><span style="--0:#E1E4E8"> OK</span></div><div class="ec-line"><span style="--0:#E1E4E8">Content-Type: </span><span style="--0:#B392F0">text/plain;</span><span style="--0:#E1E4E8"> charset=utf-</span><span style="--0:#79B8FF">8</span></div><div class="ec-line"><span style="--0:#E1E4E8">Content-Length: </span><span style="--0:#79B8FF">11</span></div><div class="ec-line"><span style="--0:#E1E4E8">Connection: keep-alive</span></div><div class="ec-line"><span style="--0:#E1E4E8">Date: Thu, </span><span style="--0:#79B8FF">27</span><span style="--0:#E1E4E8"> Jan </span><span style="--0:#79B8FF">2022</span><span style="--0:#E1E4E8"> </span><span style="--0:#79B8FF">00</span><span style="--0:#E1E4E8">:</span><span style="--0:#79B8FF">48</span><span style="--0:#E1E4E8">:</span><span style="--0:#79B8FF">26</span><span style="--0:#E1E4E8"> GMT</span></div><div class="ec-line"><span style="--0:#E1E4E8">Server: APISIX/</span><span style="--0:#79B8FF">2</span><span style="--0:#E1E4E8">.</span><span style="--0:#79B8FF">12</span><span style="--0:#E1E4E8">.</span><span style="--0:#79B8FF">0</span></div><div class="ec-line">
</div><div class="ec-line"><span style="--0:#E1E4E8">Hello World</span></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="HTTP/1.1 200 OKContent-Type: text/plain; charset=utf-8Content-Length: 11Connection: keep-aliveDate: Thu, 27 Jan 2022 00:48:26 GMTServer: APISIX/2.12.0Hello World"><div></div></button></div></figure></div>
<p>通过示例看到，Apache APISIX 中新增的路由已经可以通过 Nacos 服务发现找到正确的服务地址，并正常响应。</p>
<h1 id="总结">总结</h1>
<p>本文为大家介绍了注册中心的概念以及 Apache APISIX 如何配合 Nacos 实现基于服务发现的路由代理。实际场景中如何进行 Apache APISIX 与 Nacos 的配合使用，您需要看具体的业务需求和过往技术架构。关于 <code dir="auto">nacos</code> 插件的更多说明和完整配置信息，可参考官网文档：<a href="https://apisix.apache.org/zh/docs/apisix/discovery/nacos" rel="noopener noreferrer" target="_blank">nacos</a>。</p>  </div> </div>  </div> <div class="inline-block w-[30%] fixed bg-gray-14 h-full"> <aside> <div class="nav myroot prose"><ul>
<li>
<p><a href="#%E8%83%8C%E6%99%AF%E4%BF%A1%E6%81%AF">背景信息</a></p>
<ul>
<li><a href="#%E5%85%B3%E4%BA%8E-apache-apisix">关于 Apache APISIX</a></li>
<li><a href="#%E5%85%B3%E4%BA%8E-nacos">关于 Nacos</a></li>
</ul>
</li>
<li>
<p><a href="#%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">注册中心</a></p>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">什么是注册中心</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83">为什么需要注册中心？</a></li>
<li><a href="#apache-apisix--nacos-%E4%B8%BA%E7%94%A8%E6%88%B7%E6%8F%90%E4%BE%9B%E4%BA%86%E4%BB%80%E4%B9%88%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF">Apache APISIX + Nacos 为用户提供了什么应用场景？</a></li>
</ul>
</li>
<li>
<p><a href="#apache-apisix-%E5%9F%BA%E4%BA%8E-nacos-%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%8F%91%E7%8E%B0">Apache APISIX 基于 Nacos 实现服务发现</a></p>
<ul>
<li><a href="#%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6">前提条件</a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C">步骤一：服务注册</a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%E6%96%B0%E5%A2%9E-nacos-%E8%B7%AF%E7%94%B1">步骤二：新增 Nacos 路由</a></li>
<li><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%E9%AA%8C%E8%AF%81%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C">步骤三：验证配置结果</a></li>
</ul>
</li>
<li>
<p><a href="#%E6%80%BB%E7%BB%93">总结</a></p>
</li>
</ul></div> </aside> </div> </div>   </body> </html>